module: AWS Backup
name: check jobs completed successfully
id: backup_successful

transformation: ".min(over='23h')"
aggregation: true
filtering: "filter('namespace', 'AWS/Backup') and filter('stat', 'sum') and filter('BackupVaultName', '*', match_missing=False) and filter('ResourceType', '*', match_missing=False)"

signals:
  created:
    metric: NumberOfBackupJobsCreated
    extrapolation: zero
  completed:
    metric: NumberOfBackupJobsCompleted
    extrapolation: zero
  signal:
    formula: (created-completed)
rules:
  critical:
    threshold: 0
    comparator: ">"
    lasting_duration: 1d
    lasting_at_least: 0.9
